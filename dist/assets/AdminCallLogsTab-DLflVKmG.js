import{r as d,j as e,S as q,n as m,o as B}from"./index-WlGrQmAx.js";import{P}from"./phone-missed-DWg9wfRY.js";import{C as R}from"./circle-check-big-DPOZ1Z6F.js";const G=()=>{const[b,v]=d.useState([]),[N,y]=d.useState(!0),[x,_]=d.useState(""),[u,w]=d.useState("all"),[i,S]=d.useState("all"),[c,C]=d.useState({total:0,ended:0,rejected:0,missed:0,avgDuration:0}),D=async()=>{try{let t=m.from("calls").select("*").in("status",["ended","rejected","missed"]).order("started_at",{ascending:!1}).limit(100);if(i!=="all"){const s=new Date;let r=new Date;i==="today"?r.setHours(0,0,0,0):i==="week"?r.setDate(s.getDate()-7):i==="month"&&r.setMonth(s.getMonth()-1),t=t.gte("started_at",r.toISOString())}const{data:o,error:l}=await t;if(l)throw l;const n=await Promise.all((o||[]).map(async s=>{let r="Bilinmeyen",p="Bilinmeyen",j=0;if(s.connected_at&&s.ended_at&&(j=Math.floor((new Date(s.ended_at).getTime()-new Date(s.connected_at).getTime())/1e3)),s.caller_id.startsWith("anon_"))r="Anonim Müşteri";else if(s.caller_type==="customer"){const{data:a}=await m.from("customers").select("first_name, last_name").eq("id",s.caller_id).single();r=a?`${a.first_name} ${a.last_name}`:"Müşteri"}else if(s.caller_type==="partner"){const{data:a}=await m.from("partners").select("company_name").eq("id",s.caller_id).single();r=(a==null?void 0:a.company_name)||"Partner"}if(s.receiver_type==="partner"){const{data:a}=await m.from("partners").select("company_name").eq("id",s.receiver_id).single();p=(a==null?void 0:a.company_name)||"Partner"}else if(s.receiver_type==="customer"){const{data:a}=await m.from("customers").select("first_name, last_name").eq("id",s.receiver_id).single();p=a?`${a.first_name} ${a.last_name}`:"Müşteri"}return{...s,caller_name:r,receiver_name:p,duration_seconds:j}}));v(n);const L=n.length,h=n.filter(s=>s.status==="ended").length,M=n.filter(s=>s.status==="rejected").length,z=n.filter(s=>s.status==="missed").length,A=n.filter(s=>s.duration_seconds).reduce((s,r)=>s+(r.duration_seconds||0),0),$=h>0?Math.floor(A/h):0;C({total:L,ended:h,rejected:M,missed:z,avgDuration:$})}catch(t){console.error("❌ [AdminCallLogs] Load error:",t)}finally{y(!1)}};d.useEffect(()=>{D()},[i]);const f=b.filter(t=>{var o,l;if(u!=="all"&&t.status!==u)return!1;if(x){const n=x.toLowerCase();return((o=t.caller_name)==null?void 0:o.toLowerCase().includes(n))||((l=t.receiver_name)==null?void 0:l.toLowerCase().includes(n))}return!0}),g=t=>{const o=Math.floor(t/60),l=t%60;return`${o}:${l.toString().padStart(2,"0")}`},T=t=>{switch(t){case"ended":return e.jsxs("span",{className:"flex items-center gap-1 px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium",children:[e.jsx(R,{size:14}),"Tamamlandı"]});case"rejected":return e.jsxs("span",{className:"flex items-center gap-1 px-3 py-1 bg-red-100 text-red-700 rounded-full text-xs font-medium",children:[e.jsx(B,{size:14}),"Reddedildi"]});case"missed":return e.jsxs("span",{className:"flex items-center gap-1 px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-xs font-medium",children:[e.jsx(P,{size:14}),"Cevapsız"]});default:return null}};return N?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Çağrı Kayıtları"}),e.jsx("p",{className:"text-slate-600 mt-1",children:"Geçmiş tüm aramalar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200",children:[e.jsx("div",{className:"text-slate-600 text-sm mb-1",children:"Toplam Arama"}),e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:c.total})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-xl border border-green-200",children:[e.jsx("div",{className:"text-green-600 text-sm mb-1",children:"Tamamlandı"}),e.jsx("div",{className:"text-2xl font-bold text-green-700",children:c.ended})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-xl border border-red-200",children:[e.jsx("div",{className:"text-red-600 text-sm mb-1",children:"Reddedildi"}),e.jsx("div",{className:"text-2xl font-bold text-red-700",children:c.rejected})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-xl border border-orange-200",children:[e.jsx("div",{className:"text-orange-600 text-sm mb-1",children:"Cevapsız"}),e.jsx("div",{className:"text-2xl font-bold text-orange-700",children:c.missed})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl border border-blue-200",children:[e.jsx("div",{className:"text-blue-600 text-sm mb-1",children:"Ort. Süre"}),e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:g(c.avgDuration)})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{type:"text",placeholder:"İsim veya şirket ara...",value:x,onChange:t=>_(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]})}),e.jsxs("select",{value:u,onChange:t=>w(t.target.value),className:"px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"Tüm Durumlar"}),e.jsx("option",{value:"ended",children:"Tamamlandı"}),e.jsx("option",{value:"rejected",children:"Reddedildi"}),e.jsx("option",{value:"missed",children:"Cevapsız"})]}),e.jsxs("select",{value:i,onChange:t=>S(t.target.value),className:"px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"Tüm Zamanlar"}),e.jsx("option",{value:"today",children:"Bugün"}),e.jsx("option",{value:"week",children:"Son 7 Gün"}),e.jsx("option",{value:"month",children:"Son 30 Gün"})]})]}),e.jsx("div",{className:"bg-white rounded-xl border border-slate-200 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-slate-700",children:"Arayan"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-slate-700",children:"Aranan"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-slate-700",children:"Durum"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-slate-700",children:"Süre"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-slate-700",children:"Tarih"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-12 text-center text-slate-400",children:"Kayıt bulunamadı"})}):f.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-slate-800 font-medium",children:t.caller_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-800 font-medium",children:t.receiver_name}),e.jsx("td",{className:"px-4 py-3",children:T(t.status)}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600 font-mono",children:t.duration_seconds?g(t.duration_seconds):"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:new Date(t.started_at).toLocaleString("tr-TR")})]},t.id))})]})})]})};export{G as default};

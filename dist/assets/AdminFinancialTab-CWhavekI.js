import{r as c,j as e,V as k,t as T,S as L,s as S}from"./index-DU7nbpgv.js";import{u as $,E as F}from"./AdminDashboard-MKvuI3Rp.js";import{S as I}from"./StatusBadge-DDuB58ui.js";import{C}from"./circle-alert-BL5vRjsv.js";import{T as H}from"./trending-up-aBG52p3X.js";import{C as U}from"./circle-check-big-DW0hV3wO.js";import{B as Y}from"./building-BlBVx9DT.js";import{D as O}from"./download-CpyFMYV4.js";import{E as _}from"./eye-D_IlimC5.js";import"./activity-BQdV48A4.js";import"./tag-D2MwiuJA.js";import"./wallet-tsKlKHJd.js";import"./credit-card-B2T1ZE3V.js";import"./star-C2f4Ixfu.js";import"./log-out-CiWxhRJa.js";import"./file-text-Cb_J7V6z.js";import"./calendar-DDP1yapL.js";import"./dollar-sign-CEzCbDHU.js";import"./shield-Cwqi9Tz_.js";import"./user-plus-B07g1W6D.js";import"./square-pen-Be3Ln_Ki.js";import"./trash-2-BMsrf-7D.js";import"./mail-Bj5KUDK6.js";const K=s=>{var u;let o="completed";s.status==="cancelled"?o="failed":s.status==="refunded"&&(o="refunded");let a="kredi_karti";return s.paymentMethod==="nakit"?a="nakit":s.paymentMethod==="havale"&&(a="havale"),{id:`PAY-${(u=s.id)==null?void 0:u.slice(-8)}`,partnerId:s.partnerId||"",partnerName:s.partnerName||"Bilinmeyen Partner",jobId:s.requestId||s.id||"",service:s.serviceType||"Çekici Hizmeti",amount:s.totalAmount||0,commission:s.commission||0,partnerEarning:s.partnerEarning||0,status:o,paymentMethod:a,date:s.completionTime||new Date().toISOString(),customer:s.customerName||"Müşteri",transactionId:s.id?`TRX-${s.id.slice(-8)}`:void 0}},he=()=>{const[s,o]=c.useState(null),[a,u]=c.useState([]),[D,P]=c.useState([]),[z,y]=c.useState(!0),[v,w]=c.useState(null),[x,h]=c.useState("all"),[g,A]=c.useState("all"),{filtered:R,searchTerm:E,setSearchTerm:M}=$(a,{searchKeys:["partnerName","customer","service","jobId"]}),f=async()=>{y(!0),w(null);try{const[t,l]=await Promise.all([S.completedJobs.getAll(),S.partners.getAll()]),p=new Map;l.forEach(d=>p.set(d.id,d.name||d.company_name||"Bilinmeyen"));const N=t.map(d=>{const i=K(d);return p.has(i.partnerId)&&(i.partnerName=p.get(i.partnerId)||i.partnerName),i});u(N),P(l)}catch(t){console.error("Financial data load error:",t),w("Finansal veriler yüklenirken hata oluştu.")}finally{y(!1)}};c.useEffect(()=>{f()},[]);const m=R.filter(t=>!(x!=="all"&&t.status!==x||g!=="all"&&t.partnerId!==g)),r={totalRevenue:a.filter(t=>t.status==="completed").reduce((t,l)=>t+l.amount,0),pendingAmount:a.filter(t=>t.status==="pending").reduce((t,l)=>t+l.amount,0),refundedAmount:a.filter(t=>t.status==="refunded").reduce((t,l)=>t+l.amount,0),failedAmount:a.filter(t=>t.status==="failed").reduce((t,l)=>t+l.amount,0),completed:a.filter(t=>t.status==="completed").length,pending:a.filter(t=>t.status==="pending").length,failed:a.filter(t=>t.status==="failed").length,refunded:a.filter(t=>t.status==="refunded").length},b=t=>{switch(t){case"kredi_karti":return"Kredi Kartı";case"nakit":return"Nakit";case"havale":return"Havale";default:return t}},j=t=>{try{return new Date(t).toLocaleString("tr-TR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return t}},B=()=>{const t=["ID","Partner","Müşteri","Hizmet","Tutar","Ödeme Yöntemi","Durum","Tarih"],l=m.map(n=>[n.id,n.partnerName,n.customer,n.service,`${n.amount}₺`,b(n.paymentMethod),n.status,j(n.date)]),p=[t,...l].map(n=>n.join(",")).join(`
`),N=new Blob(["\uFEFF"+p],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(N),i=document.createElement("a");i.href=d,i.download=`yolmov-finansal-rapor-${new Date().toISOString().split("T")[0]}.csv`,i.click(),URL.revokeObjectURL(d)};return z?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):v?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(C,{className:"w-5 h-5"}),e.jsx("span",{children:v})]}),e.jsxs("button",{onClick:f,className:"mt-3 flex items-center gap-2 px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors",children:[e.jsx(k,{className:"w-4 h-4"}),"Tekrar Dene"]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(H,{size:20}),e.jsx("span",{className:"text-xs font-bold",children:"Toplam Gelir"})]}),e.jsxs("p",{className:"text-2xl font-black",children:[r.totalRevenue.toLocaleString("tr-TR"),"₺"]}),e.jsxs("p",{className:"text-xs opacity-80",children:[r.completed," tamamlanan iş"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-4 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(U,{size:20}),e.jsx("span",{className:"text-xs font-bold",children:"Tamamlanan"})]}),e.jsx("p",{className:"text-2xl font-black",children:r.completed}),e.jsx("p",{className:"text-xs opacity-80",children:"işlem"})]}),e.jsxs("div",{className:"bg-orange-50 rounded-xl border border-orange-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(C,{size:20,className:"text-orange-600"}),e.jsx("span",{className:"text-xs font-bold text-orange-600",children:"Bekleyen"})]}),e.jsxs("p",{className:"text-2xl font-black text-orange-700",children:[r.pendingAmount.toLocaleString("tr-TR"),"₺"]}),e.jsxs("p",{className:"text-xs text-orange-600",children:[r.pending," işlem"]})]}),e.jsxs("div",{className:"bg-red-50 rounded-xl border border-red-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(T,{size:20,className:"text-red-600"}),e.jsx("span",{className:"text-xs font-bold text-red-600",children:"Başarısız/İade"})]}),e.jsxs("p",{className:"text-2xl font-black text-red-700",children:[(r.failedAmount+r.refundedAmount).toLocaleString("tr-TR"),"₺"]}),e.jsxs("p",{className:"text-xs text-red-600",children:[r.failed+r.refunded," işlem"]})]})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(L,{size:20,className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Partner, müşteri, hizmet veya iş ID ara...",className:"w-full pl-12 pr-4 py-3 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none",value:E,onChange:t=>M(t.target.value)})]}),e.jsx("div",{className:"w-full lg:w-56",children:e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsxs("select",{value:g,onChange:t=>A(t.target.value),className:"w-full pl-10 pr-4 py-3 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none appearance-none",children:[e.jsx("option",{value:"all",children:"Tüm Partnerler"}),D.map(t=>e.jsx("option",{value:t.id,children:t.name||t.company_name||"Bilinmeyen"},t.id))]})]})}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>h("all"),className:`px-4 py-2 rounded-lg font-bold transition-all ${x==="all"?"bg-slate-900 text-white":"bg-white border border-slate-200 text-slate-700 hover:bg-slate-50"}`,children:["Tümü (",a.length,")"]}),e.jsxs("button",{onClick:()=>h("completed"),className:`px-4 py-2 rounded-lg font-bold transition-all ${x==="completed"?"bg-green-600 text-white":"bg-white border border-slate-200 text-slate-700 hover:bg-slate-50"}`,children:["Tamamlanan (",r.completed,")"]}),e.jsxs("button",{onClick:()=>h("pending"),className:`px-4 py-2 rounded-lg font-bold transition-all ${x==="pending"?"bg-orange-600 text-white":"bg-white border border-slate-200 text-slate-700 hover:bg-slate-50"}`,children:["Bekleyen (",r.pending,")"]}),e.jsxs("button",{onClick:f,className:"px-4 py-2 bg-slate-100 text-slate-700 rounded-lg font-bold hover:bg-slate-200 flex items-center gap-2",children:[e.jsx(k,{size:16}),"Yenile"]}),e.jsxs("button",{onClick:B,className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(O,{size:16}),"Dışa Aktar"]})]})]}),e.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-600 uppercase",children:"Ödeme ID"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-600 uppercase",children:"Partner"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-600 uppercase",children:"Müşteri"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-600 uppercase",children:"Hizmet"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-600 uppercase",children:"Tutar"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-600 uppercase",children:"Ödeme Yöntemi"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-600 uppercase",children:"Durum"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-600 uppercase",children:"İşlem"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200",children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-6 py-12",children:e.jsx(F,{title:"Ödeme Bulunamadı",description:a.length===0?"Henüz tamamlanmış iş kaydı bulunmuyor.":"Arama kriterinize uygun ödeme kaydı yok."})})}):m.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("p",{className:"font-bold text-slate-900",children:t.id}),e.jsx("p",{className:"text-xs text-slate-500",children:t.jobId})]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("p",{className:"font-bold text-slate-900",children:t.partnerName}),e.jsxs("p",{className:"text-xs text-slate-500",children:[t.partnerId.slice(0,8),"..."]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("p",{className:"text-sm text-slate-900",children:t.customer})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("p",{className:"text-sm text-slate-900",children:t.service}),e.jsx("p",{className:"text-xs text-slate-500",children:j(t.date)})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("p",{className:"font-bold text-green-600",children:[t.amount.toLocaleString("tr-TR"),"₺"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("p",{className:"text-sm text-slate-700",children:b(t.paymentMethod)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(I,{type:"payment",status:t.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{onClick:()=>o(t),className:"p-2 hover:bg-slate-100 rounded-lg",children:e.jsx(_,{size:18,className:"text-slate-400"})})})]},t.id))})]})})}),e.jsx("div",{className:"text-sm text-gray-500 text-center",children:m.length===a.length?`Toplam ${a.length} ödeme kaydı`:`${m.length} / ${a.length} ödeme kaydı gösteriliyor`}),s&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>o(null),children:e.jsxs("div",{className:"bg-white rounded-3xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Ödeme Detayları"}),e.jsx("button",{onClick:()=>o(null),className:"p-2 hover:bg-slate-100 rounded-lg",children:e.jsx(T,{size:24,className:"text-slate-400"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Ödeme ID"}),e.jsx("p",{className:"font-bold text-slate-900",children:s.id}),s.transactionId&&e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["TRX: ",s.transactionId]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"İş ID"}),e.jsx("p",{className:"font-bold text-slate-900",children:s.jobId})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Partner"}),e.jsx("p",{className:"font-bold text-slate-900",children:s.partnerName}),e.jsx("p",{className:"text-xs text-slate-500",children:s.partnerId})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Müşteri"}),e.jsx("p",{className:"font-bold text-slate-900",children:s.customer})]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Hizmet & Tarih"}),e.jsx("p",{className:"font-bold text-slate-900",children:s.service}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:j(s.date)})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl border-2 border-green-200 p-4",children:[e.jsx("p",{className:"text-xs text-green-600 mb-1",children:"Tutar"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700",children:[s.amount.toLocaleString("tr-TR"),"₺"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Ödeme Yöntemi"}),e.jsx("p",{className:"font-bold text-slate-900",children:b(s.paymentMethod)})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Durum"}),e.jsx(I,{type:"payment",status:s.status})]})]})]})]})})]})};export{he as default};

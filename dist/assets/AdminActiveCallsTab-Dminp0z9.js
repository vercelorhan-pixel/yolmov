import{c as N,r as o,w as i,j as e,P as f,N as b,C as y,ae as _,x as w}from"./index-Bn8Q3BpW.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=N("PhoneOutgoing",[["polyline",{points:"22 8 22 2 16 2",key:"1g204g"}],["line",{x1:"16",x2:"22",y1:"8",y2:"2",key:"1ggias"}],["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),D=()=>{const[c,x]=o.useState([]),[g,u]=o.useState(!0),[h,p]=o.useState({}),d=async()=>{try{const{data:s,error:a}=await i.from("calls").select("*").in("status",["ringing","connected"]).order("started_at",{ascending:!1});if(a)throw a;const n=await Promise.all((s||[]).map(async r=>{let l="Bilinmeyen",m="Bilinmeyen";if(r.caller_id.startsWith("anon_"))l="Anonim MÃ¼ÅŸteri";else if(r.caller_type==="customer"){const{data:t}=await i.from("customers").select("first_name, last_name").eq("id",r.caller_id).single();l=t?`${t.first_name} ${t.last_name}`:"MÃ¼ÅŸteri"}else if(r.caller_type==="partner"){const{data:t}=await i.from("partners").select("company_name").eq("id",r.caller_id).single();l=(t==null?void 0:t.company_name)||"Partner"}if(r.receiver_type==="partner"){const{data:t}=await i.from("partners").select("company_name").eq("id",r.receiver_id).single();m=(t==null?void 0:t.company_name)||"Partner"}else if(r.receiver_type==="customer"){const{data:t}=await i.from("customers").select("first_name, last_name").eq("id",r.receiver_id).single();m=t?`${t.first_name} ${t.last_name}`:"MÃ¼ÅŸteri"}return{...r,caller_name:l,receiver_name:m}}));x(n)}catch(s){console.error("âŒ [AdminActiveCalls] Load error:",s)}finally{u(!1)}};o.useEffect(()=>{d();const s=`admin_active_calls_${Date.now()}`,a=i.channel(s).on("postgres_changes",{event:"*",schema:"public",table:"calls"},n=>{console.log("ðŸ“ž [AdminActiveCalls] Realtime event:",n.eventType),d()}).subscribe(n=>{console.log("ðŸ“ž [AdminActiveCalls] Subscription status:",n)});return()=>{i.removeChannel(a)}},[]),o.useEffect(()=>{const s=setInterval(()=>{const a={};c.forEach(n=>{const r=new Date(n.connected_at||n.started_at).getTime(),l=Date.now();a[n.id]=Math.floor((l-r)/1e3)}),p(a)},1e3);return()=>clearInterval(s)},[c]);const j=s=>{const a=Math.floor(s/60),n=s%60;return`${a}:${n.toString().padStart(2,"0")}`},v=async s=>{try{x(a=>a.filter(n=>n.id!==s)),await i.from("calls").update({status:"ended",ended_at:new Date().toISOString()}).eq("id",s),console.log("âœ… [AdminActiveCalls] Call ended:",s),await d()}catch(a){console.error("âŒ End call error:",a),d()}};return g?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):c.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400",children:[e.jsx(f,{size:64,className:"mb-4 opacity-30"}),e.jsx("p",{className:"text-lg font-medium",children:"Åžu anda aktif arama yok"}),e.jsx("p",{className:"text-sm",children:"Aramalar baÅŸladÄ±ÄŸÄ±nda burada gÃ¶rÃ¼necek"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"CanlÄ± GÃ¶rÃ¼ÅŸmeler"}),e.jsxs("p",{className:"text-slate-600 mt-1",children:[c.length," aktif arama"]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-green-100 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-green-700 font-medium text-sm",children:"CANLI"})]})]}),e.jsx("div",{className:"grid gap-4",children:c.map(s=>e.jsx("div",{className:`p-6 rounded-xl border-2 transition-all ${s.status==="connected"?"bg-green-50 border-green-300":"bg-orange-50 border-orange-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${s.status==="connected"?"bg-green-500":"bg-orange-500"}`,children:e.jsx(f,{className:"text-white",size:24})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(C,{size:16,className:"text-slate-600"}),e.jsx("span",{className:"font-bold text-slate-800",children:s.caller_name}),e.jsx("span",{className:"text-slate-400",children:"â†’"}),e.jsx(b,{size:16,className:"text-slate-600"}),e.jsx("span",{className:"font-bold text-slate-800",children:s.receiver_name})]}),e.jsx("div",{className:"flex items-center gap-4 text-sm text-slate-600",children:s.status==="connected"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{size:14}),e.jsx("span",{className:"font-mono",children:j(h[s.id]||0)})]}),e.jsx("span",{className:"text-green-600 font-medium",children:"â— GÃ¶rÃ¼ÅŸme Devam Ediyor"})]}):e.jsx("span",{className:"text-orange-600 font-medium",children:"ðŸ”” Ã‡alÄ±yor..."})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"px-4 py-2 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 flex items-center gap-2 text-slate-700 transition-colors",title:"Dinle (YakÄ±nda)",children:[e.jsx(_,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"Dinle"})]}),e.jsxs("button",{onClick:()=>v(s.id),className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 flex items-center gap-2 transition-colors",children:[e.jsx(w,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"SonlandÄ±r"})]})]})]})},s.id))})]})};export{D as default};

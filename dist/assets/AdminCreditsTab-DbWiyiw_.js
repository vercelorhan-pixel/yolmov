import{c as U,r,j as e,J as B,P as L,S as _,s as g}from"./index-CUgg6Tth.js";import{u as Q,E as P}from"./AdminDashboard-D4GS2m5k.js";import{C as V}from"./circle-alert-DW9aAgen.js";import{W as X}from"./wallet-J0MISTvB.js";import{C as Z}from"./calendar-DA_5RCfV.js";import{P as R}from"./plus-BcCP6PZQ.js";import{B as ee}from"./building-9p286aXP.js";import{F as te}from"./filter-CQkoqUXo.js";import"./activity-C7jKSKMb.js";import"./tag-C7H7Yf2W.js";import"./credit-card-BRdPSEzC.js";import"./star-GnRHbEiv.js";import"./log-out-ZV7w6qPq.js";import"./file-text-8MqkDXHR.js";import"./dollar-sign-BU9Fh7c2.js";import"./circle-check-big-Dm8W2_JS.js";import"./StatusBadge-DsbToaGZ.js";import"./shield-DiuDjy8H.js";import"./user-plus-USM5V6d1.js";import"./eye-DzonD-MX.js";import"./square-pen-CY4CQizQ.js";import"./trash-2-DgiWbD5w.js";import"./mail-D_tGWTg6.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=U("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=U("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),Te=()=>{const[o,N]=r.useState([]),[n,y]=r.useState([]),[ae,M]=r.useState([]),[$,v]=r.useState(!0),[w,k]=r.useState(null),[l,S]=r.useState(null),[E,m]=r.useState(!1),[p,A]=r.useState(""),[u,T]=r.useState(""),[d,h]=r.useState("all"),{filtered:C,searchTerm:F,setSearchTerm:q}=Q(n,{searchKeys:["partnerName","description","requestId"]}),f=async()=>{v(!0),k(null);try{const[t,s,j]=await Promise.all([g.partnerCredits.getAll(),g.partnerCredits.getAllTransactions(),g.partners.getAll()]),i=new Map;j.forEach(a=>i.set(a.id,a.name||a.company_name||"Bilinmeyen"));const x=t.map(a=>({partnerId:a.partnerId,partnerName:a.partnerName||i.get(a.partnerId)||"Bilinmeyen Partner",balance:a.balance||0,totalPurchased:a.totalPurchased||0,totalUsed:a.totalUsed||0,lastTransaction:a.lastUpdated})),Y=s.map(a=>({id:a.id,partnerId:a.partnerId,partnerName:a.partnerName||i.get(a.partnerId)||"Bilinmeyen Partner",type:a.type,amount:a.amount,balanceBefore:a.balanceBefore||0,balanceAfter:a.balanceAfter||0,description:a.description||"",date:a.createdAt||new Date().toISOString(),requestId:a.requestId,adminUser:a.adminUser}));N(x),y(Y),M(j)}catch(t){console.error("Credits data load error:",t),k("Kredi verileri yüklenirken hata oluştu.")}finally{v(!1)}};r.useEffect(()=>{f()},[]);const b=d==="all"?C:C.filter(t=>t.type===d),z=t=>{const s=(t.description||"").toLowerCase();return t.amount>0&&(t.type==="adjustment"||s.includes("admin")||s.includes("manuel"))},H=n.filter(z).reduce((t,s)=>t+s.amount,0),O=n.filter(t=>t.type==="purchase"&&!z(t)).reduce((t,s)=>t+s.amount,0),c={totalBalance:o.reduce((t,s)=>t+s.balance,0),totalPurchased:O,adminAdded:H,totalUsed:o.reduce((t,s)=>t+s.totalUsed,0),activePartners:o.filter(t=>t.balance>0).length},W=async()=>{if(!l||!p||!u)return;const t=parseFloat(p);if(isNaN(t)||t===0){alert("Geçerli bir miktar girin");return}try{const s=await g.partnerCredits.adjustCredits(l.partnerId,l.partnerName,t,u,"Admin User"),j={id:s.transaction.id,partnerId:s.transaction.partnerId,partnerName:s.transaction.partnerName,type:"adjustment",amount:s.transaction.amount,balanceBefore:s.transaction.balanceBefore,balanceAfter:s.transaction.balanceAfter,description:s.transaction.description,date:s.transaction.date||new Date().toISOString(),adminUser:s.transaction.adminUser};y(i=>[j,...i]),N(i=>i.map(x=>x.partnerId===l.partnerId?{...x,balance:s.newBalance}:x)),m(!1),A(""),T(""),S(null)}catch(s){console.error("Kredi düzeltme hatası:",s),alert("Kredi düzeltme işlemi başarısız: "+(s instanceof Error?s.message:"Bilinmeyen hata"))}},I=t=>{switch(t){case"purchase":return"text-green-600 bg-green-50";case"usage":return"text-blue-600 bg-blue-50";case"adjustment":return"text-purple-600 bg-purple-50";case"refund":return"text-red-600 bg-red-50"}},G=t=>{switch(t){case"purchase":return"Satın Alım";case"usage":return"Kullanım";case"adjustment":return"Düzeltme";case"refund":return"İade"}},J=t=>{switch(t){case"purchase":return e.jsx(D,{size:16});case"usage":return e.jsx(L,{size:16});case"adjustment":return e.jsx(te,{size:16});case"refund":return e.jsx(se,{size:16})}},K=t=>{if(!t)return"-";try{return new Date(t).toLocaleString("tr-TR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return t}};return $?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):w?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(V,{className:"w-5 h-5"}),e.jsx("span",{children:w})]}),e.jsxs("button",{onClick:f,className:"mt-3 flex items-center gap-2 px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors",children:[e.jsx(B,{className:"w-4 h-4"}),"Tekrar Dene"]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-4 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(X,{size:20}),e.jsx("span",{className:"text-xs font-bold",children:"Toplam Bakiye"})]}),e.jsxs("p",{className:"text-2xl font-black",children:[c.totalBalance.toLocaleString("tr-TR")," Kredi"]}),e.jsxs("p",{className:"text-xs opacity-80",children:[c.activePartners," aktif partner"]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl border border-blue-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(D,{size:20,className:"text-blue-600"}),e.jsx("span",{className:"text-xs font-bold text-blue-600",children:"Satın Alınan"})]}),e.jsxs("p",{className:"text-2xl font-black text-blue-700",children:[c.totalPurchased.toLocaleString("tr-TR")," Kredi"]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-xl border border-purple-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(L,{size:20,className:"text-purple-600"}),e.jsx("span",{className:"text-xs font-bold text-purple-600",children:"Kullanılan"})]}),e.jsxs("p",{className:"text-2xl font-black text-purple-700",children:[c.totalUsed.toLocaleString("tr-TR")," Kredi"]})]}),e.jsxs("div",{className:"bg-orange-50 rounded-xl border border-orange-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Z,{size:20,className:"text-orange-600"}),e.jsx("span",{className:"text-xs font-bold text-orange-600",children:"Kullanılabilir"})]}),e.jsxs("p",{className:"text-2xl font-black text-orange-700",children:[c.totalBalance.toLocaleString("tr-TR")," Kredi"]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(R,{size:20,className:"text-slate-600"}),e.jsx("span",{className:"text-xs font-bold text-slate-600",children:"Admin Eklenen"})]}),e.jsxs("p",{className:"text-2xl font-black text-slate-700",children:[c.adminAdded.toLocaleString("tr-TR")," Kredi"]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"Partner Hesapları"}),e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-3 py-1.5 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors text-sm",children:[e.jsx(B,{size:14}),"Yenile"]})]}),o.length===0?e.jsx(P,{title:"Hesap Bulunamadı",description:"Henüz kredi hesabı olan partner bulunmuyor."}):e.jsx("div",{className:"space-y-3",children:o.map(t=>e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4 hover:bg-slate-100 transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(ee,{size:20,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900",children:t.partnerName}),e.jsxs("p",{className:"text-xs text-slate-500",children:[t.partnerId.slice(0,8),"..."]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-black text-green-600",children:[t.balance.toLocaleString("tr-TR")," Kredi"]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Mevcut Bakiye"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Toplam Satın Alınan"}),e.jsxs("p",{className:"font-bold text-blue-600",children:[t.totalPurchased.toLocaleString("tr-TR")," Kredi"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Toplam Kullanılan"}),e.jsxs("p",{className:"font-bold text-purple-600",children:[t.totalUsed.toLocaleString("tr-TR")," Kredi"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Kalan"}),e.jsxs("p",{className:"font-bold text-orange-600",children:[t.balance.toLocaleString("tr-TR")," Kredi"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-xs text-slate-500",children:["Son İşlem: ",K(t.lastTransaction)]}),e.jsxs("button",{onClick:()=>{S(t),m(!0)},className:"px-3 py-1 bg-blue-600 text-white rounded-lg text-sm font-bold hover:bg-blue-700 flex items-center gap-1",children:[e.jsx(R,{size:14}),"Düzeltme"]})]})]},t.partnerId))})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(_,{size:20,className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Partner, açıklama veya talep ID ara...",className:"w-full pl-12 pr-4 py-3 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none",value:F,onChange:t=>q(t.target.value)})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("button",{onClick:()=>h("all"),className:`px-4 py-2 rounded-lg font-bold transition-all ${d==="all"?"bg-slate-900 text-white":"bg-white border border-slate-200 text-slate-700 hover:bg-slate-50"}`,children:"Tümü"}),e.jsx("button",{onClick:()=>h("purchase"),className:`px-4 py-2 rounded-lg font-bold transition-all ${d==="purchase"?"bg-green-600 text-white":"bg-white border border-slate-200 text-slate-700 hover:bg-slate-50"}`,children:"Satın Alım"}),e.jsx("button",{onClick:()=>h("usage"),className:`px-4 py-2 rounded-lg font-bold transition-all ${d==="usage"?"bg-blue-600 text-white":"bg-white border border-slate-200 text-slate-700 hover:bg-slate-50"}`,children:"Kullanım"}),e.jsx("button",{onClick:()=>h("adjustment"),className:`px-4 py-2 rounded-lg font-bold transition-all ${d==="adjustment"?"bg-purple-600 text-white":"bg-white border border-slate-200 text-slate-700 hover:bg-slate-50"}`,children:"Düzeltme"})]})]}),e.jsx("div",{className:"space-y-3",children:b.length===0?e.jsx(P,{title:"İşlem Bulunamadı",description:n.length===0?"Henüz kredi işlemi bulunmuyor.":"Arama kriterinize uygun işlem yok."}):b.map(t=>e.jsx("div",{className:"bg-white rounded-xl border border-slate-200 p-4 hover:shadow-md transition-all",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${I(t.type)}`,children:J(t.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-bold text-slate-900",children:t.partnerName}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-bold ${I(t.type)}`,children:G(t.type)})]}),e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:t.description}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-400 flex-wrap",children:[e.jsx("span",{children:K(t.date)}),e.jsx("span",{children:"•"}),e.jsx("span",{children:t.id}),t.requestId&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:t.requestId})]}),t.adminUser&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Admin: ",t.adminUser]})]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`text-xl font-black ${t.amount>=0?"text-green-600":"text-red-600"}`,children:[t.amount>=0?"+":"",t.amount.toLocaleString("tr-TR")," Kredi"]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Önceki: ",t.balanceBefore.toLocaleString("tr-TR")," → Sonraki: ",t.balanceAfter.toLocaleString("tr-TR")]})]})]})},t.id))}),e.jsx("div",{className:"text-sm text-gray-500 text-center",children:b.length===n.length?`Toplam ${n.length} işlem`:`${b.length} / ${n.length} işlem gösteriliyor`}),E&&l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:()=>m(!1),children:e.jsxs("div",{className:"bg-white rounded-3xl p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-4",children:"Kredi Düzeltme"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Partner"}),e.jsx("p",{className:"font-bold text-slate-900",children:l.partnerName}),e.jsx("p",{className:"text-xs text-slate-500",children:l.partnerId})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl border-2 border-green-200 p-4",children:[e.jsx("p",{className:"text-xs text-green-600 mb-1",children:"Mevcut Kredi Bakiyesi"}),e.jsxs("p",{className:"text-2xl font-black text-green-700",children:[l.balance.toLocaleString("tr-TR")," Kredi"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"Kredi Miktarı (+ veya -)"}),e.jsx("input",{type:"number",placeholder:"Örn: +50 veya -10",className:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none",value:p,onChange:t=>A(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"Sebep"}),e.jsx("textarea",{placeholder:"Düzeltme sebebini yazın...",className:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none",rows:3,value:u,onChange:t=>T(t.target.value)})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>m(!1),className:"flex-1 px-4 py-3 bg-slate-200 text-slate-700 rounded-xl font-bold hover:bg-slate-300",children:"İptal"}),e.jsx("button",{onClick:W,disabled:!p||!u,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Onayla"})]})]})]})})]})};export{Te as default};

import{u as E,r as s,j as e,d as N,L,o as w}from"./index-BrwBfCHk.js";import{C as K}from"./circle-check-CpIGVDf2.js";import{M as A}from"./mail-C-mRnHGA.js";import{L as _}from"./lock-BQ-nKS57.js";const M=()=>{const u=E(),[a,v]=s.useState(""),[i,S]=s.useState(""),[r,k]=s.useState(""),[n,z]=s.useState(""),[d,x]=s.useState(!1),[p,c]=s.useState(""),[h,m]=s.useState(""),C=async t=>{var b;if(t.preventDefault(),c(""),m(""),!a||!i||!r||!n){c("Lütfen tüm alanları doldurun.");return}x(!0);try{try{const o=await fetch("/api/bootstrap-admin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:i,firstName:r,lastName:n})}),j=await o.json().catch(()=>({}));if(o.ok&&j.ok){m("Kayıt başarılı! Giriş sayfasına yönlendiriliyorsunuz..."),setTimeout(()=>u("/operasyon"),1500);return}console.warn("Bootstrap failed, trying client-side:",j)}catch(o){console.warn("Bootstrap endpoint error:",o)}const{data:l,error:g}=await w.auth.signUp({email:a,password:i,options:{data:{user_type:"admin",first_name:r,last_name:n}}});if(g)throw g;const f=(b=l.user)==null?void 0:b.id;if(!f)throw new Error("Kullanıcı oluşturulamadı");const{error:y}=await w.from("admin_users").insert({id:f,name:`${r} ${n}`,email:a,role:"super_admin",permissions:["all"]});if(y)throw y;m("Kayıt başarılı! Admin paneline yönlendiriliyorsunuz..."),setTimeout(()=>u("/admin"),1500)}catch(l){c((l==null?void 0:l.message)||"Beklenmeyen bir hata oluştu")}finally{x(!1)}};return e.jsx("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center p-6",children:e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 w-full max-w-md p-6",children:[e.jsx("h1",{className:"text-xl font-bold text-slate-900 mb-2",children:"Admin Kayıt"}),e.jsx("p",{className:"text-sm text-slate-600 mb-6",children:"İlk kayıt SUPER ADMIN yetkisiyle oluşturulacak."}),p&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 text-sm rounded-xl p-3 mb-4",children:p}),h&&e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-700 text-sm rounded-xl p-3 mb-4 flex items-center gap-2",children:[e.jsx(K,{size:16})," ",h]}),e.jsxs("form",{className:"space-y-4",onSubmit:C,children:[e.jsxs("div",{className:"flex items-center gap-2 bg-slate-50 border rounded-xl px-3 py-2",children:[e.jsx(N,{size:16,className:"text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Ad",className:"w-full bg-transparent outline-none text-sm",value:r,onChange:t=>k(t.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-50 border rounded-xl px-3 py-2",children:[e.jsx(N,{size:16,className:"text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Soyad",className:"w-full bg-transparent outline-none text-sm",value:n,onChange:t=>z(t.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-50 border rounded-xl px-3 py-2",children:[e.jsx(A,{size:16,className:"text-slate-400"}),e.jsx("input",{type:"email",placeholder:"E-posta",className:"w-full bg-transparent outline-none text-sm",value:a,onChange:t=>v(t.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-50 border rounded-xl px-3 py-2",children:[e.jsx(_,{size:16,className:"text-slate-400"}),e.jsx("input",{type:"password",placeholder:"Şifre",className:"w-full bg-transparent outline-none text-sm",value:i,onChange:t=>S(t.target.value)})]}),e.jsx("button",{type:"submit",disabled:d,className:`w-full py-3 rounded-xl font-bold text-white ${d?"bg-slate-300":"bg-slate-900 hover:bg-slate-800"}`,children:d?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"animate-spin",size:16})," Kayıt Yapılıyor..."]}):"Kayıt Ol"}),e.jsxs("p",{className:"text-center text-xs text-slate-400 mt-2",children:["Zaten hesabınız var mı? ",e.jsx("a",{className:"underline",href:"/admin/giris",children:"Giriş Yap"})]})]})]})})};export{M as default};

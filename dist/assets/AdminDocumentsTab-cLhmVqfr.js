import{r as l,s as N,j as e,t as G,p as u,S as I,d as L}from"./index-B96qjpmI.js";import{u as Y,E as _}from"./AdminDashboard-CSpZQijA.js";import{S as C}from"./StatusBadge-D9O8yPqV.js";import{F as T}from"./file-text-DzMnV4u5.js";import{C as y}from"./circle-check-big-CfiGJ0wT.js";import{F as K}from"./filter-5Fi627aH.js";import{E as M}from"./eye-DMcmj402.js";import{D as q}from"./download-C9NS9gq9.js";import"./activity-Ao-IJMcs.js";import"./tag-yeuuCGIQ.js";import"./wallet-DIM6pNiW.js";import"./credit-card-DvVUxDUl.js";import"./star-DJo5WLX6.js";import"./log-out-cGX14-Ep.js";import"./calendar-5_IxpoiD.js";import"./dollar-sign-B2IB7Fkv.js";import"./shield-D8ddTCBm.js";import"./user-plus-DFF0o7Fy.js";import"./square-pen-C0kyFeU0.js";import"./trash-2-BtTNiK9D.js";import"./mail-CnPOnHZF.js";const h={license:"Sürücü Belgesi",insurance:"Sigorta Poliçesi",registration:"Araç Ruhsatı",tax:"Vergi Levhası",identity:"Kimlik Belgesi"},pe=()=>{const[s,a]=l.useState(null),[v,c]=l.useState(!1),[m,g]=l.useState(""),[i,A]=l.useState([]),[d,w]=l.useState("all"),[o,k]=l.useState("all"),[x,D]=l.useState("all");l.useEffect(()=>{j()},[]);const j=async()=>{try{const t=await N.partnerDocuments.getAll();A(t)}catch(t){console.error("❌ Belgeler yüklenemedi:",t)}},R=Array.from(new Set(i.map(t=>t.partnerName))).sort();let r=i;if(d!=="all"&&(r=r.filter(t=>t.partnerName===d)),x!=="all"&&(r=r.filter(t=>t.type===x)),o!=="all"){const t=new Date;r=r.filter(n=>{const f=new Date(n.uploadDate);switch(o){case"today":return f.toDateString()===t.toDateString();case"week":const P=new Date(t.getTime()-10080*60*1e3);return f>=P;case"month":const U=new Date(t.getTime()-720*60*60*1e3);return f>=U;default:return!0}})}const{filtered:S,searchTerm:F,setSearchTerm:E,filterType:b,setFilterType:B}=Y(r,{searchKeys:["partnerName","fileName"],statusKey:"status"}),z=async t=>{try{await N.partnerDocuments.update(t.id,{status:"approved",reviewedAt:new Date().toISOString()}),await j(),a(null)}catch(n){console.error("❌ Belge onaylanamadı:",n),alert("Belge onaylanırken hata oluştu.")}},p={total:i.length,pending:i.filter(t=>t.status==="pending").length,approved:i.filter(t=>t.status==="approved").length,rejected:i.filter(t=>t.status==="rejected").length},O=async()=>{if(!(!s||!m.trim()))try{await N.partnerDocuments.update(s.id,{status:"rejected",rejectionReason:m,reviewedAt:new Date().toISOString()}),await j(),c(!1),g(""),a(null)}catch(t){console.error("❌ Belge reddedilemedi:",t),alert("Belge reddedilirken hata oluştu.")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(T,{size:20,className:"text-slate-400"}),e.jsx("span",{className:"text-xs font-bold text-slate-500",children:"Toplam"})]}),e.jsx("p",{className:"text-2xl font-black text-slate-900",children:p.total})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-xl border border-yellow-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(G,{size:20,className:"text-yellow-600"}),e.jsx("span",{className:"text-xs font-bold text-yellow-600",children:"Bekliyor"})]}),e.jsx("p",{className:"text-2xl font-black text-yellow-700",children:p.pending})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl border border-green-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(y,{size:20,className:"text-green-600"}),e.jsx("span",{className:"text-xs font-bold text-green-600",children:"Onaylı"})]}),e.jsx("p",{className:"text-2xl font-black text-green-700",children:p.approved})]}),e.jsxs("div",{className:"bg-red-50 rounded-xl border border-red-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(u,{size:20,className:"text-red-600"}),e.jsx("span",{className:"text-xs font-bold text-red-600",children:"Reddedilen"})]}),e.jsx("p",{className:"text-2xl font-black text-red-700",children:p.rejected})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2 relative",children:[e.jsx(I,{size:20,className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Partner veya dosya adı ile ara...",className:"w-full pl-12 pr-4 py-3 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none",value:F,onChange:t=>E(t.target.value)})]}),e.jsxs("select",{className:"px-4 py-3 bg-white border border-slate-200 rounded-xl font-medium text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none",value:d,onChange:t=>w(t.target.value),children:[e.jsx("option",{value:"all",children:"Tüm Acenteler"}),R.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{className:"px-4 py-3 bg-white border border-slate-200 rounded-xl font-medium text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none",value:x,onChange:t=>D(t.target.value),children:[e.jsx("option",{value:"all",children:"Tüm Belge Tipleri"}),Object.entries(h).map(([t,n])=>e.jsx("option",{value:t,children:n},t))]}),e.jsxs("select",{className:"px-4 py-3 bg-white border border-slate-200 rounded-xl font-medium text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none",value:o,onChange:t=>k(t.target.value),children:[e.jsx("option",{value:"all",children:"Tüm Zamanlar"}),e.jsx("option",{value:"today",children:"Bugün"}),e.jsx("option",{value:"week",children:"Son 7 Gün"}),e.jsx("option",{value:"month",children:"Son 30 Gün"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("select",{className:"px-4 py-3 bg-white border border-slate-200 rounded-xl font-medium text-slate-700 focus:ring-2 focus:ring-blue-500 outline-none",value:b,onChange:t=>B(t.target.value),children:[e.jsx("option",{value:"all",children:"Tüm Durumlar"}),e.jsx("option",{value:"pending",children:"Onay Bekliyor"}),e.jsx("option",{value:"approved",children:"Onaylı"}),e.jsx("option",{value:"rejected",children:"Reddedilen"})]}),(d!=="all"||o!=="all"||x!=="all"||b!=="all")&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 bg-orange-50 border border-orange-200 rounded-xl",children:[e.jsx(K,{size:18,className:"text-orange-600"}),e.jsxs("span",{className:"text-sm font-bold text-orange-700",children:[[d!=="all",o!=="all",x!=="all",b!=="all"].filter(Boolean).length," Filtre Aktif"]}),e.jsx("button",{onClick:()=>{w("all"),k("all"),D("all"),B("all")},className:"ml-2 text-xs text-orange-600 hover:text-orange-700 font-bold underline",children:"Temizle"})]})]}),e.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 overflow-hidden",children:S.length===0?e.jsx(_,{title:"Belge Bulunamadı",description:"Arama kriterinize uygun belge yok."}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-600 uppercase",children:"Partner"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-600 uppercase",children:"Belge Tipi"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-600 uppercase",children:"Dosya"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-600 uppercase",children:"Yüklenme"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-600 uppercase",children:"Son Geçerlilik"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-600 uppercase",children:"Durum"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-bold text-slate-600 uppercase",children:"İşlemler"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:S.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{size:16,className:"text-slate-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900 text-sm",children:t.partnerName}),e.jsx("p",{className:"text-xs text-slate-500",children:t.partnerId})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"text-sm font-medium text-slate-700",children:h[t.type]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"cursor-pointer hover:text-orange-600 transition-colors",onClick:()=>a(t),children:[e.jsx("p",{className:"text-sm font-mono text-slate-900 underline",children:t.fileName}),e.jsx("p",{className:"text-xs text-slate-500",children:t.fileSize})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-600",children:t.uploadDate}),e.jsx("td",{className:"px-6 py-4",children:t.expiryDate?e.jsx("span",{className:"text-sm text-slate-700",children:t.expiryDate}):e.jsx("span",{className:"text-xs text-slate-400",children:"-"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(C,{type:"document",status:t.status})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>a(t),className:"p-2 text-slate-400 hover:text-blue-600 bg-slate-50 hover:bg-blue-50 rounded-lg transition-colors",title:"Görüntüle",children:e.jsx(M,{size:18})}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>z(t),className:"p-2 text-green-600 hover:text-green-700 bg-green-50 hover:bg-green-100 rounded-lg transition-colors",title:"Onayla",children:e.jsx(y,{size:18})}),e.jsx("button",{onClick:()=>{a(t),c(!0)},className:"p-2 text-red-600 hover:text-red-700 bg-red-50 hover:bg-red-100 rounded-lg transition-colors",title:"Reddet",children:e.jsx(u,{size:18})})]})]})})]},t.id))})]})}),s&&!v&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto",onClick:()=>a(null),children:e.jsxs("div",{className:"bg-white rounded-3xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto my-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Belge Detayları"}),e.jsx("button",{onClick:()=>a(null),className:"p-2 hover:bg-slate-100 rounded-lg",children:e.jsx(u,{size:24,className:"text-slate-400"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Partner"}),e.jsx("p",{className:"font-bold text-slate-900",children:s.partnerName}),e.jsx("p",{className:"text-xs text-slate-500",children:s.partnerId})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Belge Tipi"}),e.jsx("p",{className:"font-bold text-slate-900",children:h[s.type]})]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Dosya Bilgisi"}),e.jsx("p",{className:"font-mono text-sm text-slate-900",children:s.fileName}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:s.fileSize})]}),s.fileUrl&&e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Belge Önizleme"}),e.jsx("div",{className:"bg-white rounded-lg border border-slate-200 p-2 flex items-center justify-center min-h-[200px]",children:s.fileName.toLowerCase().endsWith(".pdf")?e.jsxs("div",{className:"text-center",children:[e.jsx(T,{size:48,className:"text-slate-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-slate-600",children:"PDF Belgesi"}),e.jsx("a",{href:s.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:underline mt-1 inline-block",children:"Yeni sekmede aç"})]}):e.jsx("img",{src:s.fileUrl,alt:s.fileName,className:"max-w-full max-h-[300px] object-contain rounded",onError:t=>{const n=t.target;n.style.display="none"}})}),e.jsxs("a",{href:s.fileUrl,target:"_blank",rel:"noopener noreferrer",download:s.fileName,className:"mt-2 text-xs text-blue-600 hover:underline flex items-center gap-1",children:[e.jsx(q,{size:12})," Dosyayı İndir"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-1",children:"Yüklenme Tarihi"}),e.jsx("p",{className:"font-bold text-slate-900",children:s.uploadDate})]}),s.expiryDate&&e.jsxs("div",{className:"bg-orange-50 rounded-xl p-4 border border-orange-200",children:[e.jsx("p",{className:"text-xs text-orange-600 mb-1",children:"Son Geçerlilik"}),e.jsx("p",{className:"font-bold text-orange-900",children:s.expiryDate})]})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Durum"}),e.jsx(C,{type:"document",status:s.status})]}),s.status==="rejected"&&s.rejectionReason&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs font-bold text-red-600 mb-1",children:"Red Nedeni:"}),e.jsx("p",{className:"text-sm text-red-800",children:s.rejectionReason}),s.reviewedBy&&e.jsxs("p",{className:"text-xs text-red-600 mt-2",children:[s.reviewedBy," • ",s.reviewedAt]})]}),s.status==="approved"&&s.reviewedBy&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4",children:[e.jsx("p",{className:"text-xs font-bold text-green-600 mb-1",children:"Onaylayan:"}),e.jsx("p",{className:"text-sm text-green-800",children:s.reviewedBy}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:s.reviewedAt})]}),s.status==="pending"&&e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs("button",{onClick:()=>c(!0),className:"flex-1 py-3 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 flex items-center justify-center gap-2",children:[e.jsx(u,{size:18}),"Reddet"]}),e.jsxs("button",{onClick:()=>z(s),className:"flex-1 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 flex items-center justify-center gap-2",children:[e.jsx(y,{size:18}),"Onayla"]})]})]})]})}),v&&s&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl p-6 max-w-lg w-full",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 mb-4",children:"Belge Reddetme"}),e.jsxs("p",{className:"text-sm text-slate-600 mb-4",children:[e.jsx("strong",{children:s.partnerName})," firmasının ",e.jsx("strong",{children:h[s.type]})," belgesini neden reddediyorsunuz?"]}),e.jsx("textarea",{className:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-red-500 outline-none resize-none",rows:4,placeholder:"Red nedenini açıklayın (zorunlu)...",value:m,onChange:t=>g(t.target.value)}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{onClick:()=>{c(!1),g("")},className:"flex-1 py-3 bg-slate-100 text-slate-700 rounded-xl font-bold hover:bg-slate-200",children:"İptal"}),e.jsx("button",{onClick:O,disabled:!m.trim(),className:"flex-1 py-3 bg-red-600 text-white rounded-xl font-bold hover:bg-red-700 disabled:bg-slate-200 disabled:text-slate-400 disabled:cursor-not-allowed",children:"Reddet"})]})]})})]})};export{pe as default};

import{c as N,r as o,n as r,j as e,P as x,y,C as b,a6 as _,o as w}from"./index-BnAbWxD9.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=N("PhoneOutgoing",[["polyline",{points:"22 8 22 2 16 2",key:"1g204g"}],["line",{x1:"16",x2:"22",y1:"8",y2:"2",key:"1ggias"}],["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),k=()=>{const[c,f]=o.useState([]),[h,u]=o.useState(!0),[g,p]=o.useState({}),m=async()=>{try{const{data:s,error:n}=await r.from("calls").select("*").in("status",["ringing","connected"]).order("started_at",{ascending:!1});if(n)throw n;const i=await Promise.all((s||[]).map(async a=>{let l="Bilinmeyen",d="Bilinmeyen";if(a.caller_id.startsWith("anon_"))l="Anonim MÃ¼ÅŸteri";else if(a.caller_type==="customer"){const{data:t}=await r.from("customers").select("first_name, last_name").eq("id",a.caller_id).single();l=t?`${t.first_name} ${t.last_name}`:"MÃ¼ÅŸteri"}else if(a.caller_type==="partner"){const{data:t}=await r.from("partners").select("company_name").eq("id",a.caller_id).single();l=(t==null?void 0:t.company_name)||"Partner"}if(a.receiver_type==="partner"){const{data:t}=await r.from("partners").select("company_name").eq("id",a.receiver_id).single();d=(t==null?void 0:t.company_name)||"Partner"}else if(a.receiver_type==="customer"){const{data:t}=await r.from("customers").select("first_name, last_name").eq("id",a.receiver_id).single();d=t?`${t.first_name} ${t.last_name}`:"MÃ¼ÅŸteri"}return{...a,caller_name:l,receiver_name:d}}));f(i)}catch(s){console.error("âŒ [AdminActiveCalls] Load error:",s)}finally{u(!1)}};o.useEffect(()=>{m();const s=r.channel("admin_active_calls").on("postgres_changes",{event:"*",schema:"public",table:"calls"},()=>{m()}).subscribe();return()=>{r.removeChannel(s)}},[]),o.useEffect(()=>{const s=setInterval(()=>{const n={};c.forEach(i=>{const a=new Date(i.connected_at||i.started_at).getTime(),l=Date.now();n[i.id]=Math.floor((l-a)/1e3)}),p(n)},1e3);return()=>clearInterval(s)},[c]);const j=s=>{const n=Math.floor(s/60),i=s%60;return`${n}:${i.toString().padStart(2,"0")}`},v=async s=>{try{await r.from("calls").update({status:"ended",ended_at:new Date().toISOString()}).eq("id",s)}catch(n){console.error("âŒ End call error:",n)}};return h?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):c.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-slate-400",children:[e.jsx(x,{size:64,className:"mb-4 opacity-30"}),e.jsx("p",{className:"text-lg font-medium",children:"Åžu anda aktif arama yok"}),e.jsx("p",{className:"text-sm",children:"Aramalar baÅŸladÄ±ÄŸÄ±nda burada gÃ¶rÃ¼necek"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"CanlÄ± GÃ¶rÃ¼ÅŸmeler"}),e.jsxs("p",{className:"text-slate-600 mt-1",children:[c.length," aktif arama"]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-green-100 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-green-700 font-medium text-sm",children:"CANLI"})]})]}),e.jsx("div",{className:"grid gap-4",children:c.map(s=>e.jsx("div",{className:`p-6 rounded-xl border-2 transition-all ${s.status==="connected"?"bg-green-50 border-green-300":"bg-orange-50 border-orange-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${s.status==="connected"?"bg-green-500":"bg-orange-500"}`,children:e.jsx(x,{className:"text-white",size:24})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(C,{size:16,className:"text-slate-600"}),e.jsx("span",{className:"font-bold text-slate-800",children:s.caller_name}),e.jsx("span",{className:"text-slate-400",children:"â†’"}),e.jsx(y,{size:16,className:"text-slate-600"}),e.jsx("span",{className:"font-bold text-slate-800",children:s.receiver_name})]}),e.jsx("div",{className:"flex items-center gap-4 text-sm text-slate-600",children:s.status==="connected"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{size:14}),e.jsx("span",{className:"font-mono",children:j(g[s.id]||0)})]}),e.jsx("span",{className:"text-green-600 font-medium",children:"â— GÃ¶rÃ¼ÅŸme Devam Ediyor"})]}):e.jsx("span",{className:"text-orange-600 font-medium",children:"ðŸ”” Ã‡alÄ±yor..."})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"px-4 py-2 bg-white border border-slate-300 rounded-lg hover:bg-slate-50 flex items-center gap-2 text-slate-700 transition-colors",title:"Dinle (YakÄ±nda)",children:[e.jsx(_,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"Dinle"})]}),e.jsxs("button",{onClick:()=>v(s.id),className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 flex items-center gap-2 transition-colors",children:[e.jsx(w,{size:18}),e.jsx("span",{className:"text-sm font-medium",children:"SonlandÄ±r"})]})]})]})},s.id))})]})};export{k as default};

import{c as P,r as d,j as e,ab as Z,S as J,aa as Q,q as x,t as Y}from"./index-DUPWpW8A.js";import{D as ee}from"./download-H6v1Cw9I.js";import{P as te}from"./phone-missed-Ba21WdZ-.js";import{C as se}from"./circle-check-big-XQGMyZIM.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=P("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=P("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),ie=()=>{const[w,E]=d.useState([]),[R,M]=d.useState(!0),[b,A]=d.useState(""),[v,U]=d.useState("all"),[p,q]=d.useState("all"),[f,F]=d.useState(new Map),[u,y]=d.useState(null),[m]=d.useState(new Audio),[S,C]=d.useState(0),[N,h]=d.useState(!1),[g,K]=d.useState({total:0,ended:0,rejected:0,missed:0,avgDuration:0,recordedCalls:0}),O=async t=>{try{const s=t.map(o=>o.recording_id).filter(Boolean);if(s.length===0)return;const{data:r,error:n}=await x.from("call_recordings").select("*").in("id",s).eq("status","ready");if(n)throw n;const i=new Map;(r||[]).forEach(o=>{i.set(o.call_id,o)}),F(i)}catch(s){console.error("âŒ [AdminCallLogs] Load recordings error:",s)}},L=async(t,s)=>{try{const r=f.get(t);if(!r)return;if(u===t&&N){m.pause(),h(!1);return}if(u!==t){const{data:n,error:i}=await x.storage.from("call-recordings").createSignedUrl(r.file_path,3600);if(i)throw i;if(!(n!=null&&n.signedUrl))throw new Error("No signed URL");m.src=n.signedUrl,m.load(),await x.from("call_recordings").update({play_count:r.play_count+1,last_played_at:new Date().toISOString()}).eq("id",s)}m.play(),y(t),h(!0)}catch(r){console.error("âŒ [AdminCallLogs] Play recording error:",r),alert("KayÄ±t oynatÄ±lamadÄ±: "+r.message)}},B=async t=>{try{const s=f.get(t);if(!s)return;const{data:r,error:n}=await x.storage.from("call-recordings").download(s.file_path);if(n)throw n;const i=URL.createObjectURL(r),o=document.createElement("a");o.href=i,o.download=s.file_name,o.click(),URL.revokeObjectURL(i)}catch(s){console.error("âŒ [AdminCallLogs] Download error:",s),alert("KayÄ±t indirilemedi: "+s.message)}};d.useEffect(()=>{const t=m,s=()=>C(t.currentTime),r=()=>{h(!1),y(null),C(0)},n=()=>h(!1),i=()=>h(!0);return t.addEventListener("timeupdate",s),t.addEventListener("ended",r),t.addEventListener("pause",n),t.addEventListener("play",i),()=>{t.removeEventListener("timeupdate",s),t.removeEventListener("ended",r),t.removeEventListener("pause",n),t.removeEventListener("play",i)}},[m]);const $=async()=>{try{let t=x.from("calls").select("*").in("status",["ended","rejected","missed"]).order("started_at",{ascending:!1}).limit(100);if(p!=="all"){const a=new Date;let c=new Date;p==="today"?c.setHours(0,0,0,0):p==="week"?c.setDate(a.getDate()-7):p==="month"&&c.setMonth(a.getMonth()-1),t=t.gte("started_at",c.toISOString())}const{data:s,error:r}=await t;if(r)throw r;const n=await Promise.all((s||[]).map(async a=>{let c="Bilinmeyen",_="Bilinmeyen",T=0;if(a.connected_at&&a.ended_at&&(T=Math.floor((new Date(a.ended_at).getTime()-new Date(a.connected_at).getTime())/1e3)),a.caller_id.startsWith("anon_"))c="Anonim MÃ¼ÅŸteri";else if(a.caller_type==="customer"){const{data:l}=await x.from("customers").select("first_name, last_name").eq("id",a.caller_id).single();c=l?`${l.first_name} ${l.last_name}`:"MÃ¼ÅŸteri"}else if(a.caller_type==="partner"){const{data:l}=await x.from("partners").select("company_name").eq("id",a.caller_id).single();c=(l==null?void 0:l.company_name)||"Partner"}if(a.receiver_type==="partner"){const{data:l}=await x.from("partners").select("company_name").eq("id",a.receiver_id).single();_=(l==null?void 0:l.company_name)||"Partner"}else if(a.receiver_type==="customer"){const{data:l}=await x.from("customers").select("first_name, last_name").eq("id",a.receiver_id).single();_=l?`${l.first_name} ${l.last_name}`:"MÃ¼ÅŸteri"}return{...a,caller_name:c,receiver_name:_,duration_seconds:T}}));E(n);const i=n.length,o=n.filter(a=>a.status==="ended").length,G=n.filter(a=>a.status==="rejected").length,W=n.filter(a=>a.status==="missed").length,H=n.filter(a=>a.is_recorded).length,V=n.filter(a=>a.duration_seconds).reduce((a,c)=>a+(c.duration_seconds||0),0),X=o>0?Math.floor(V/o):0;K({total:i,ended:o,rejected:G,missed:W,avgDuration:X,recordedCalls:H}),await O(n.filter(a=>a.is_recorded&&a.recording_id))}catch(t){console.error("âŒ [AdminCallLogs] Load error:",t)}finally{M(!1)}};d.useEffect(()=>{$()},[p]);const D=w.filter(t=>{var s,r;if(v!=="all"&&t.status!==v)return!1;if(b){const n=b.toLowerCase();return((s=t.caller_name)==null?void 0:s.toLowerCase().includes(n))||((r=t.receiver_name)==null?void 0:r.toLowerCase().includes(n))}return!0}),j=t=>{const s=Math.floor(t/60),r=t%60;return`${s}:${r.toString().padStart(2,"0")}`},I=t=>{switch(t){case"ended":return e.jsxs("span",{className:"flex items-center gap-1 px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium",children:[e.jsx(se,{size:14}),"TamamlandÄ±"]});case"rejected":return e.jsxs("span",{className:"flex items-center gap-1 px-3 py-1 bg-red-100 text-red-700 rounded-full text-xs font-medium",children:[e.jsx(Y,{size:14}),"Reddedildi"]});case"missed":return e.jsxs("span",{className:"flex items-center gap-1 px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-xs font-medium",children:[e.jsx(te,{size:14}),"CevapsÄ±z"]});default:return null}};return R?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Ã‡aÄŸrÄ± KayÄ±tlarÄ±"}),e.jsx("p",{className:"text-slate-600 mt-1",children:"GeÃ§miÅŸ tÃ¼m aramalar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200",children:[e.jsx("div",{className:"text-slate-600 text-sm mb-1",children:"Toplam Arama"}),e.jsx("div",{className:"text-2xl font-bold text-slate-800",children:g.total})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-xl border border-green-200",children:[e.jsx("div",{className:"text-green-600 text-sm mb-1",children:"TamamlandÄ±"}),e.jsx("div",{className:"text-2xl font-bold text-green-700",children:g.ended})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-xl border border-red-200",children:[e.jsx("div",{className:"text-red-600 text-sm mb-1",children:"Reddedildi"}),e.jsx("div",{className:"text-2xl font-bold text-red-700",children:g.rejected})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-xl border border-orange-200",children:[e.jsx("div",{className:"text-orange-600 text-sm mb-1",children:"CevapsÄ±z"}),e.jsx("div",{className:"text-2xl font-bold text-orange-700",children:g.missed})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl border border-blue-200",children:[e.jsx("div",{className:"text-blue-600 text-sm mb-1",children:"Ort. SÃ¼re"}),e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:j(g.avgDuration)})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-xl border border-purple-200",children:[e.jsxs("div",{className:"text-purple-600 text-sm mb-1 flex items-center gap-1",children:[e.jsx(Z,{size:14}),"KayÄ±tlÄ±"]}),e.jsx("div",{className:"text-2xl font-bold text-purple-700",children:g.recordedCalls})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{type:"text",placeholder:"Ä°sim veya ÅŸirket ara...",value:b,onChange:t=>A(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"})]})}),e.jsxs("select",{value:v,onChange:t=>U(t.target.value),className:"px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"TÃ¼m Durumlar"}),e.jsx("option",{value:"ended",children:"TamamlandÄ±"}),e.jsx("option",{value:"rejected",children:"Reddedildi"}),e.jsx("option",{value:"missed",children:"CevapsÄ±z"})]}),e.jsxs("select",{value:p,onChange:t=>q(t.target.value),className:"px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"TÃ¼m Zamanlar"}),e.jsx("option",{value:"today",children:"BugÃ¼n"}),e.jsx("option",{value:"week",children:"Son 7 GÃ¼n"}),e.jsx("option",{value:"month",children:"Son 30 GÃ¼n"})]})]}),e.jsx("div",{className:"bg-white rounded-xl border border-slate-200 overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-slate-700",children:"Arayan"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-slate-700",children:"Aranan"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-slate-700",children:"Durum"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-slate-700",children:"SÃ¼re"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-slate-700",children:"Tarih"}),e.jsx("th",{className:"text-left px-4 py-3 text-sm font-semibold text-slate-700",children:"ðŸŽ™ï¸ KayÄ±t"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:D.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-12 text-center text-slate-400",children:"KayÄ±t bulunamadÄ±"})}):D.map(t=>{const s=f.get(t.id),r=u===t.id&&N;return e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-slate-800 font-medium",children:t.caller_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-800 font-medium",children:t.receiver_name}),e.jsx("td",{className:"px-4 py-3",children:I(t.status)}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600 font-mono",children:t.duration_seconds?j(t.duration_seconds):"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:new Date(t.started_at).toLocaleString("tr-TR")}),e.jsx("td",{className:"px-4 py-3",children:t.is_recorded&&s?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>L(t.id,s.id),className:`p-2 rounded-lg transition-colors ${r?"bg-purple-100 text-purple-700 hover:bg-purple-200":"bg-slate-100 text-slate-600 hover:bg-slate-200"}`,title:r?"Duraklat":"Oynat",children:r?e.jsx(z,{size:16}):e.jsx(k,{size:16})}),e.jsx("button",{onClick:()=>B(t.id),className:"p-2 rounded-lg bg-slate-100 text-slate-600 hover:bg-slate-200 transition-colors",title:"Ä°ndir",children:e.jsx(ee,{size:16})}),e.jsxs("div",{className:"text-xs text-slate-500",children:[(s.file_size_bytes/1024/1024).toFixed(1)," MB"]})]}):t.is_recorded?e.jsx("span",{className:"text-xs text-orange-600",children:"Ä°ÅŸleniyor..."}):e.jsx("span",{className:"text-xs text-slate-400",children:"KayÄ±t yok"})})]},t.id)})})]})}),u&&e.jsxs("div",{className:"fixed bottom-6 right-6 bg-white rounded-xl shadow-2xl border border-slate-200 p-4 w-80 z-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"text-purple-600",size:20}),e.jsx("div",{className:"text-sm font-semibold text-slate-800",children:"KayÄ±t OynatÄ±cÄ±"})]}),e.jsx("button",{onClick:()=>{m.pause(),y(null),h(!1)},className:"text-slate-400 hover:text-slate-600",children:"Ã—"})]}),(()=>{const t=w.find(r=>r.id===u),s=f.get(u);return!t||!s?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-slate-600 mb-3",children:[e.jsxs("div",{className:"font-medium",children:[t.caller_name," â†’ ",t.receiver_name]}),e.jsx("div",{className:"text-slate-400",children:new Date(t.started_at).toLocaleString("tr-TR")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>L(u,s.id),className:"p-2 rounded-lg bg-purple-100 text-purple-700 hover:bg-purple-200 transition-colors",children:N?e.jsx(z,{size:18}):e.jsx(k,{size:18})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"range",min:"0",max:m.duration||0,value:S,onChange:r=>{m.currentTime=parseFloat(r.target.value)},className:"w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-purple-600"})}),e.jsxs("div",{className:"text-xs text-slate-600 font-mono",children:[j(Math.floor(S))," / ",j(s.duration_seconds)]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[e.jsxs("span",{children:["Opus ",s.compression_ratio.toFixed(1),"x sÄ±kÄ±ÅŸtÄ±rma"]}),e.jsxs("span",{children:[s.play_count," kez dinlendi"]})]})]})]})})()]})]})};export{ie as default};

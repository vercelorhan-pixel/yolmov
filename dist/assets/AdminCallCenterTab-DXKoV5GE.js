import{r as n,x as H,a9 as r,j as e,L as C,H as O,U as b,E as S,y as A,C as _,P as k,m as M,z as F}from"./index-C8l4yRJn.js";import{R as Y}from"./refresh-cw-70Azv7XL.js";import{U as q}from"./AdminDashboard-GNrNRstY.js";import{C as J}from"./circle-check-BSscGEIv.js";import{A as z}from"./activity-CdB4E2YY.js";import"./tag-WQEd_zuG.js";import"./wallet-XmPuezqR.js";import"./credit-card-TQcRDCmO.js";import"./eye-ITOk9SW5.js";import"./star-C3hs-Ecp.js";import"./log-out-DfJbcYPp.js";import"./file-text-CaY37Fvz.js";import"./calendar-DkhWvn5o.js";import"./dollar-sign-B0oexKwd.js";import"./circle-check-big-BwfFw-3G.js";import"./StatusBadge-BSss9viI.js";import"./shield-CbhuVSql.js";import"./user-plus-7vROuvVw.js";import"./square-pen-DY2PlSrn.js";import"./trash-2-Z4xbFMtr.js";import"./mail-Do2JAu0S.js";const d=({label:a,value:o,icon:t,color:c,subtext:l})=>e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-100 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:`w-10 h-10 ${c} rounded-lg flex items-center justify-center`,children:e.jsx(t,{size:20,className:"text-white"})}),e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:o})]}),e.jsx("p",{className:"text-sm text-gray-600",children:a}),l&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:l})]}),V=({status:a})=>{const o={online:{color:"bg-green-100 text-green-700",label:"Çevrimiçi"},busy:{color:"bg-red-100 text-red-700",label:"Meşgul"},away:{color:"bg-yellow-100 text-yellow-700",label:"Uzakta"},offline:{color:"bg-gray-100 text-gray-500",label:"Çevrimdışı"}},{color:t,label:c}=o[a];return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t}`,children:c})},W=({status:a})=>{const o={waiting:{color:"bg-yellow-100 text-yellow-700",label:"Bekliyor"},ringing:{color:"bg-blue-100 text-blue-700",label:"Çalıyor"},answered:{color:"bg-green-100 text-green-700",label:"Görüşmede"},completed:{color:"bg-gray-100 text-gray-600",label:"Tamamlandı"},abandoned:{color:"bg-red-100 text-red-700",label:"İptal"},missed:{color:"bg-orange-100 text-orange-700",label:"Cevapsız"}},{color:t,label:c}=o[a];return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t}`,children:c})},T=a=>{const o=Math.floor(a/60),t=a%60;return`${o}:${t.toString().padStart(2,"0")}`},K=a=>new Date(a).toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit"}),fe=()=>{const[a,o]=n.useState(null),[t,c]=n.useState(null),[l,y]=n.useState(null),[j,u]=n.useState([]),[g,f]=n.useState([]),[B,$]=n.useState([]),[D,v]=n.useState(!0),[X,L]=n.useState(null),[N,w]=n.useState(!1),{answerCallById:P,rejectCallById:Q}=H(),m=n.useCallback(async()=>{try{v(!0);const s=localStorage.getItem("yolmov_admin");if(s){const p=JSON.parse(s);o(p)}const[i,x,h,G]=await Promise.all([r.getCallCenterStats(),r.getCallAgents(),r.getActiveCalls(),r.getCallQueues()]);if(y(i),u(x),f(h),$(G),a){const p=x.find(U=>U.admin_id===a.id);c(p||null)}}catch(s){console.error("Load error:",s),L("Veriler yüklenirken hata oluştu")}finally{v(!1)}},[a]);n.useEffect(()=>{m();const s=r.subscribeToQueueChanges(h=>{r.getActiveCalls().then(f),r.getCallCenterStats().then(y)}),i=r.subscribeToAgentChanges(h=>{r.getCallAgents().then(u)}),x=setInterval(()=>{m()},3e4);return()=>{s(),i(),clearInterval(x)}},[m]);const R=async()=>{if(a){w(!0);try{t||await r.registerAsAgent(a.id,a.name);const s=(t==null?void 0:t.status)==="online"?"offline":"online";await r.updateAgentStatus(a.id,s);const i=await r.getCallAgents();u(i),c(i.find(x=>x.admin_id===a.id)||null)}catch(s){console.error("Toggle status error:",s)}finally{w(!1)}}},I=async s=>{if(s.call_id)try{await r.updateQueueAssignmentStatus(s.id,"answered"),await P(s.call_id),a&&await r.setAgentCurrentCall(a.id,s.call_id),m()}catch(i){console.error("Answer call error:",i)}},E=async s=>{if(s.call_id)try{await r.updateQueueAssignmentStatus(s.id,"missed"),await Q(s.call_id),m()}catch(i){console.error("Reject call error:",i)}};return D&&!l?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(C,{className:"w-8 h-8 text-brand-orange animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(O,{className:"text-brand-orange"}),"Çağrı Merkezi"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Gelen çağrıları yönetin ve müşterilere destek sağlayın"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:m,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Yenile",children:e.jsx(Y,{size:18,className:"text-gray-500"})}),e.jsx("button",{onClick:R,disabled:N,className:`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all ${(t==null?void 0:t.status)==="online"?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:N?e.jsx(C,{size:16,className:"animate-spin"}):(t==null?void 0:t.status)==="online"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Çevrimiçi"]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full"}),"Çevrimdışı"]})})]})]}),l&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4",children:[e.jsx(d,{label:"Toplam Agent",value:l.totalAgents,icon:b,color:"bg-slate-500"}),e.jsx(d,{label:"Çevrimiçi",value:l.onlineAgents,icon:q,color:"bg-green-500"}),e.jsx(d,{label:"Bekleyen",value:l.waitingCalls,icon:S,color:"bg-yellow-500"}),e.jsx(d,{label:"Aktif Görüşme",value:l.activeCalls,icon:A,color:"bg-blue-500"}),e.jsx(d,{label:"Bugün Tamamlanan",value:l.todayCompleted,icon:J,color:"bg-emerald-500"}),e.jsx(d,{label:"Ort. Bekleme",value:T(l.avgWaitTime),icon:_,color:"bg-orange-500"}),e.jsx(d,{label:"Ort. Görüşme",value:T(l.avgTalkTime),icon:z,color:"bg-purple-500"})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-4",children:e.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-100 flex items-center justify-between",children:e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(S,{size:18,className:"text-brand-orange"}),"Aktif Çağrılar",g.length>0&&e.jsx("span",{className:"px-2 py-0.5 bg-orange-100 text-orange-600 text-xs rounded-full",children:g.length})]})}),e.jsx("div",{className:"divide-y divide-gray-50",children:g.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(k,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Şu an aktif çağrı yok"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Yeni çağrılar burada görünecek"})]}):g.map(s=>e.jsx(M.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.caller_name||"Anonim Arayan"}),e.jsx(W,{status:s.status})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[s.caller_phone&&e.jsx("span",{children:s.caller_phone}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_,{size:12}),K(s.queued_at)]}),e.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-100 rounded",children:s.queue_name})]}),s.target_partner_id&&e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["→ Partner: ",s.partner_name||s.target_partner_id]}),s.caller_message&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1 italic",children:['"',s.caller_message,'"']})]}),s.status==="waiting"||s.status==="ringing"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>I(s),className:"p-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",title:"Cevapla",children:e.jsx(k,{size:18})}),e.jsx("button",{onClick:()=>E(s),className:"p-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors",title:"Reddet",children:e.jsx(F,{size:18})})]}):e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(A,{size:18,className:"animate-pulse"}),e.jsx("span",{className:"text-sm font-medium",children:"Görüşmede"})]})]})},s.id))})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-100",children:e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(b,{size:18,className:"text-brand-orange"}),"Ajanlar"]})}),e.jsx("div",{className:"divide-y divide-gray-50 max-h-[400px] overflow-y-auto",children:j.length===0?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(b,{className:"w-10 h-10 text-gray-300 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Henüz agent yok"})]}):j.map(s=>e.jsxs("div",{className:`p-3 flex items-center justify-between ${s.admin_id===(a==null?void 0:a.id)?"bg-orange-50":""}`,children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900 text-sm",children:[s.display_name||s.admin_name,s.admin_id===(a==null?void 0:a.id)&&e.jsx("span",{className:"ml-1 text-xs text-orange-500",children:"(Sen)"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Bugün: ",s.calls_handled_today," çağrı"]})]}),e.jsx(V,{status:s.status})]},s.id))})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-100",children:e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(z,{size:18,className:"text-brand-orange"}),"Çağrı Havuzları"]})}),e.jsx("div",{className:"divide-y divide-gray-50",children:B.map(s=>e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.description})]}),e.jsx("span",{className:`w-2 h-2 rounded-full ${s.is_active?"bg-green-500":"bg-gray-300"}`})]})},s.id))})]})]})]})]})};export{fe as default};

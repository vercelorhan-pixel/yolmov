import{r as c,x as g,j as e,v as A,S as J,X as z}from"./index-DcZZzKOi.js";import{A as a,u as X,E as Q}from"./AdminDashboard-DkePuI_m.js";import{U as C}from"./user-plus-DQ9TXdkM.js";import{M as V}from"./mail-CCxv9oEE.js";import{S as j}from"./shield-DtI3Gb9v.js";import{C as W}from"./calendar-ArQdBKZu.js";import{S as U}from"./square-pen-BjfAsy2J.js";import{T as Z}from"./trash-2-QXe2BwMk.js";import{E as ee}from"./eye-off-BZkizBJT.js";import{E as se}from"./eye-CoI_nV4v.js";import"./activity-B-LYQuyB.js";import"./tag-Dcjx5fmH.js";import"./wallet-BoGxZxtq.js";import"./credit-card-DjGQSLm9.js";import"./star-C8K0VV47.js";import"./log-out-ChBKhMu0.js";import"./file-text-Dvpxin_W.js";import"./dollar-sign-n8wnjpZt.js";import"./circle-check-big-DedJFj46.js";import"./StatusBadge-C4ZNuqIh.js";const ye=()=>{const[m,b]=c.useState([]),[T,S]=c.useState(!0),[O,f]=c.useState(!1),[I,N]=c.useState(!1),[u,v]=c.useState(null),[p,y]=c.useState(!1),[w,E]=c.useState(!1),[k,i]=c.useState(null),[l,o]=c.useState({name:"",email:"",password:"",role:a.SUPPORT,status:"active"}),{filtered:D,searchTerm:P,setSearchTerm:M,filterType:R,setFilterType:_}=X(m,{searchKeys:["name","email"],statusKey:"status"});c.useEffect(()=>{F()},[]);const F=async()=>{S(!0);try{const{data:s,error:t}=await g.from("admin_users").select("*").order("created_at",{ascending:!1});if(t)throw t;const r=(s||[]).map(n=>{var d;return{id:n.id,name:n.name||((d=n.email)==null?void 0:d.split("@")[0])||"Admin",email:n.email,role:n.role||a.SUPPORT,status:n.status||"active",createdAt:n.created_at?new Date(n.created_at).toLocaleDateString("tr-TR"):"-",lastLogin:n.last_login?new Date(n.last_login).toLocaleString("tr-TR"):"-"}});b(r)}catch(s){console.error("❌ Admin kullanıcıları yüklenemedi:",s),i("Admin kullanıcıları yüklenirken hata oluştu")}finally{S(!1)}},L=s=>({[a.SUPER_ADMIN]:"Süper Admin",[a.FINANCE]:"Finans",[a.OPERATIONS]:"Operasyon",[a.SUPPORT]:"Destek"})[s],K=s=>{switch(s){case a.SUPER_ADMIN:return"bg-purple-100 text-purple-700 border-purple-200";case a.FINANCE:return"bg-green-100 text-green-700 border-green-200";case a.OPERATIONS:return"bg-blue-100 text-blue-700 border-blue-200";case a.SUPPORT:return"bg-orange-100 text-orange-700 border-orange-200";default:return"bg-slate-100 text-slate-700 border-slate-200"}},x=()=>{o({name:"",email:"",password:"",role:a.SUPPORT,status:"active"}),E(!1),i(null)},q=async()=>{var s,t;if(!l.name||!l.email||!l.password){i("Tüm alanları doldurunuz");return}if(l.password.length<6){i("Şifre en az 6 karakter olmalıdır");return}y(!0),i(null);try{const r=await fetch("/api/create-admin-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l.email,password:l.password,name:l.name,role:l.role})}),n=await r.json();if(!r.ok){if((s=n.error)!=null&&s.includes("Missing Supabase keys")||r.status===404){console.warn("⚠️ API kullanılamadı, client-side signUp deneniyor..."),await Y();return}throw new Error(n.error||"Admin oluşturulamadı")}const d=n.user;b(H=>[{id:d.id,name:d.name,email:d.email,role:d.role,status:d.status,createdAt:new Date().toLocaleDateString("tr-TR"),lastLogin:"-"},...H]),f(!1),x()}catch(r){console.error("❌ Admin ekleme hatası:",r),(t=r.message)!=null&&t.includes("already registered")?i("Bu email adresi zaten kayıtlı"):i(r.message||"Admin eklenirken hata oluştu")}finally{y(!1)}},Y=async()=>{try{const{data:s,error:t}=await g.auth.signUp({email:l.email,password:l.password,options:{data:{user_type:"admin",name:l.name}}});if(t)throw t;if(!s.user)throw new Error("Kullanıcı oluşturulamadı");const{data:r,error:n}=await g.from("admin_users").insert({id:s.user.id,email:l.email,name:l.name,role:l.role,status:l.status}).select().single();if(n)throw n;b(d=>[{id:r.id,name:r.name,email:r.email,role:r.role,status:r.status,createdAt:new Date().toLocaleDateString("tr-TR"),lastLogin:"-"},...d]),f(!1),x(),alert("Kullanıcı oluşturuldu ancak email onayı gerekebilir (Local Dev Modu).")}catch(s){throw s}},$=async()=>{if(u){y(!0),i(null);try{const{error:s}=await g.from("admin_users").update({name:l.name,role:l.role,status:l.status}).eq("id",u.id);if(s)throw s;b(t=>t.map(r=>r.id===u.id?{...r,name:l.name,role:l.role,status:l.status}:r)),N(!1),v(null),x()}catch(s){console.error("❌ Admin güncelleme hatası:",s),i(s.message||"Admin güncellenirken hata oluştu")}finally{y(!1)}}},B=async s=>{if(s.role===a.SUPER_ADMIN){alert("Süper Admin kullanıcısı silinemez.");return}if(confirm(`${s.name} kullanıcısı silinecek. Onaylıyor musunuz?`))try{const{error:t}=await g.from("admin_users").delete().eq("id",s.id);if(t)throw t;b(r=>r.filter(n=>n.id!==s.id))}catch(t){console.error("❌ Admin silme hatası:",t),alert("Admin silinirken hata oluştu: "+(t.message||"Bilinmeyen hata"))}},G=s=>{v(s),o({name:s.name,email:s.email,password:"",role:s.role,status:s.status}),N(!0),i(null)},h={total:m.length,active:m.filter(s=>s.status==="active").length,superAdmin:m.filter(s=>s.role===a.SUPER_ADMIN).length,finance:m.filter(s=>s.role===a.FINANCE).length,operations:m.filter(s=>s.role===a.OPERATIONS).length,support:m.filter(s=>s.role===a.SUPPORT).length};return T?e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(A,{className:"animate-spin text-orange-600",size:32}),e.jsx("span",{className:"ml-3 text-slate-600",children:"Admin kullanıcıları yükleniyor..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-black text-slate-900",children:"Admin Kullanıcıları"}),e.jsx("p",{className:"text-slate-500 mt-1",children:"Sistem yöneticilerini ve rollerini yönetin"})]}),e.jsxs("button",{onClick:()=>{x(),f(!0)},className:"px-6 py-3 bg-orange-600 text-white rounded-xl font-bold hover:bg-orange-700 transition-colors flex items-center gap-2",children:[e.jsx(C,{size:20}),"Yeni Admin Ekle"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-4",children:[e.jsx("p",{className:"text-xs text-slate-500 font-bold mb-1",children:"Toplam"}),e.jsx("p",{className:"text-3xl font-black text-slate-900",children:h.total})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl border border-green-200 p-4",children:[e.jsx("p",{className:"text-xs text-green-700 font-bold mb-1",children:"Aktif"}),e.jsx("p",{className:"text-3xl font-black text-green-900",children:h.active})]}),e.jsxs("div",{className:"bg-purple-50 rounded-xl border border-purple-200 p-4",children:[e.jsx("p",{className:"text-xs text-purple-700 font-bold mb-1",children:"Süper Admin"}),e.jsx("p",{className:"text-3xl font-black text-purple-900",children:h.superAdmin})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl border border-green-200 p-4",children:[e.jsx("p",{className:"text-xs text-green-700 font-bold mb-1",children:"Finans"}),e.jsx("p",{className:"text-3xl font-black text-green-900",children:h.finance})]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl border border-blue-200 p-4",children:[e.jsx("p",{className:"text-xs text-blue-700 font-bold mb-1",children:"Operasyon"}),e.jsx("p",{className:"text-3xl font-black text-blue-900",children:h.operations})]}),e.jsxs("div",{className:"bg-orange-50 rounded-xl border border-orange-200 p-4",children:[e.jsx("p",{className:"text-xs text-orange-700 font-bold mb-1",children:"Destek"}),e.jsx("p",{className:"text-3xl font-black text-orange-900",children:h.support})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(J,{size:20,className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Admin ara...",className:"w-full pl-12 pr-4 py-3 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500 outline-none",value:P,onChange:s=>M(s.target.value)})]}),e.jsxs("select",{className:"px-4 py-3 bg-white border border-slate-200 rounded-xl font-medium text-slate-700 focus:ring-2 focus:ring-orange-500 outline-none",value:R,onChange:s=>_(s.target.value),children:[e.jsx("option",{value:"",children:"Tüm Durumlar"}),e.jsx("option",{value:"active",children:"Aktif"}),e.jsx("option",{value:"disabled",children:"Devre Dışı"})]})]}),e.jsx("div",{className:"bg-white rounded-2xl border border-slate-200 overflow-hidden",children:D.length===0?e.jsx(Q,{title:"Admin Kullanıcı Yok",description:P||R?"Arama kriterine uygun admin bulunamadı.":"Henüz admin kullanıcı yok."}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-600 uppercase",children:"Admin"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-600 uppercase",children:"E-posta"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-600 uppercase",children:"Rol"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-600 uppercase",children:"Durum"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-600 uppercase",children:"Son Giriş"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-bold text-slate-600 uppercase",children:"İşlemler"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:D.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-orange-400 to-orange-600 flex items-center justify-center text-white font-bold",children:s.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900",children:s.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:[s.id.substring(0,8),"..."]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{size:16,className:"text-slate-400"}),e.jsx("span",{className:"text-sm text-slate-600",children:s.email})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold border ${K(s.role)}`,children:[e.jsx(j,{size:12,className:"inline mr-1"}),L(s.role)]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${s.status==="active"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:s.status==="active"?"Aktif":"Devre Dışı"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsx(W,{size:14,className:"text-slate-400"}),s.lastLogin||"-"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>G(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Düzenle",children:e.jsx(U,{size:18})}),s.role!==a.SUPER_ADMIN&&e.jsx("button",{onClick:()=>B(s),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Sil",children:e.jsx(Z,{size:18})})]})})]},s.id))})]})}),e.jsxs("div",{className:"bg-slate-50 rounded-2xl border border-slate-200 p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 mb-4",children:"Rol Açıklamaları"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-white rounded-xl border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(j,{size:20,className:"text-purple-600"}),e.jsx("span",{className:"font-bold text-purple-900",children:"Süper Admin"})]}),e.jsx("p",{className:"text-sm text-slate-600",children:"Tüm yetkilere sahip. Sistem genelinde her işlemi yapabilir."})]}),e.jsxs("div",{className:"p-4 bg-white rounded-xl border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(j,{size:20,className:"text-green-600"}),e.jsx("span",{className:"font-bold text-green-900",children:"Finans"})]}),e.jsx("p",{className:"text-sm text-slate-600",children:"Finansal işlemler, teklifler, krediler ve raporları yönetir."})]}),e.jsxs("div",{className:"p-4 bg-white rounded-xl border border-blue-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(j,{size:20,className:"text-blue-600"}),e.jsx("span",{className:"font-bold text-blue-900",children:"Operasyon"})]}),e.jsx("p",{className:"text-sm text-slate-600",children:"Filo yönetimi, belgeler ve operasyonel işlemler için yetki."})]}),e.jsxs("div",{className:"p-4 bg-white rounded-xl border border-orange-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(j,{size:20,className:"text-orange-600"}),e.jsx("span",{className:"font-bold text-orange-900",children:"Destek"})]}),e.jsx("p",{className:"text-sm text-slate-600",children:"Müşteri ve partner destek talepleri, değerlendirmeler için yetki."})]})]})]}),O&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-black text-slate-900",children:"Yeni Admin Ekle"}),e.jsx("button",{onClick:()=>{f(!1),x()},className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(z,{size:20})})]}),k&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:k}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"Ad Soyad *"}),e.jsx("input",{type:"text",value:l.name,onChange:s=>o(t=>({...t,name:s.target.value})),className:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500 outline-none",placeholder:"Admin adı"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"E-posta *"}),e.jsx("input",{type:"email",value:l.email,onChange:s=>o(t=>({...t,email:s.target.value})),className:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500 outline-none",placeholder:"admin@ornek.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"Şifre *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:w?"text":"password",value:l.password,onChange:s=>o(t=>({...t,password:s.target.value})),className:"w-full px-4 py-3 pr-12 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500 outline-none",placeholder:"En az 6 karakter"}),e.jsx("button",{type:"button",onClick:()=>E(!w),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600",children:w?e.jsx(ee,{size:20}):e.jsx(se,{size:20})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"Rol *"}),e.jsxs("select",{value:l.role,onChange:s=>o(t=>({...t,role:s.target.value})),className:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500 outline-none",children:[e.jsx("option",{value:a.SUPPORT,children:"Destek"}),e.jsx("option",{value:a.OPERATIONS,children:"Operasyon"}),e.jsx("option",{value:a.FINANCE,children:"Finans"}),e.jsx("option",{value:a.SUPER_ADMIN,children:"Süper Admin"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"Durum"}),e.jsxs("select",{value:l.status,onChange:s=>o(t=>({...t,status:s.target.value})),className:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500 outline-none",children:[e.jsx("option",{value:"active",children:"Aktif"}),e.jsx("option",{value:"disabled",children:"Devre Dışı"})]})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx("button",{onClick:()=>{f(!1),x()},className:"flex-1 px-4 py-3 border border-slate-200 rounded-xl font-bold text-slate-700 hover:bg-slate-50 transition-colors",children:"İptal"}),e.jsxs("button",{onClick:q,disabled:p,className:"flex-1 px-4 py-3 bg-orange-600 text-white rounded-xl font-bold hover:bg-orange-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:[p?e.jsx(A,{className:"animate-spin",size:18}):e.jsx(C,{size:18}),p?"Ekleniyor...":"Admin Ekle"]})]})]})}),I&&u&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-black text-slate-900",children:"Admin Düzenle"}),e.jsx("button",{onClick:()=>{N(!1),v(null),x()},className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(z,{size:20})})]}),k&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:k}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"Ad Soyad"}),e.jsx("input",{type:"text",value:l.name,onChange:s=>o(t=>({...t,name:s.target.value})),className:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"E-posta"}),e.jsx("input",{type:"email",value:l.email,disabled:!0,className:"w-full px-4 py-3 border border-slate-200 rounded-xl bg-slate-50 text-slate-500"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"E-posta değiştirilemez"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"Rol"}),e.jsxs("select",{value:l.role,onChange:s=>o(t=>({...t,role:s.target.value})),className:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500 outline-none",disabled:u.role===a.SUPER_ADMIN,children:[e.jsx("option",{value:a.SUPPORT,children:"Destek"}),e.jsx("option",{value:a.OPERATIONS,children:"Operasyon"}),e.jsx("option",{value:a.FINANCE,children:"Finans"}),e.jsx("option",{value:a.SUPER_ADMIN,children:"Süper Admin"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"Durum"}),e.jsxs("select",{value:l.status,onChange:s=>o(t=>({...t,status:s.target.value})),className:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-orange-500 outline-none",disabled:u.role===a.SUPER_ADMIN,children:[e.jsx("option",{value:"active",children:"Aktif"}),e.jsx("option",{value:"disabled",children:"Devre Dışı"})]})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx("button",{onClick:()=>{N(!1),v(null),x()},className:"flex-1 px-4 py-3 border border-slate-200 rounded-xl font-bold text-slate-700 hover:bg-slate-50 transition-colors",children:"İptal"}),e.jsxs("button",{onClick:$,disabled:p,className:"flex-1 px-4 py-3 bg-orange-600 text-white rounded-xl font-bold hover:bg-orange-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:[p?e.jsx(A,{className:"animate-spin",size:18}):e.jsx(U,{size:18}),p?"Kaydediliyor...":"Güncelle"]})]})]})})]})};export{ye as default};
